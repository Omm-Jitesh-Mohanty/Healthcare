

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safety Simon Says</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fredoka One', cursive;
            background-color: #D1FAE5; /* A calming, friendly green */
        }
        .action-button {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-bottom: 4px solid rgba(0,0,0,0.2);
        }
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .action-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-bottom-width: 2px;
        }
        /* Feedback animation */
        @keyframes pop-in {
            0% { transform: scale(0.5) rotate(-10deg); opacity: 0; }
            70% { transform: scale(1.1) rotate(5deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        .feedback-popup {
            animation: pop-in 0.3s ease-out forwards;
        }
        #timer-bar {
            transition: width 0.1s linear;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <div id="game-container" class="relative w-full max-w-2xl mx-auto text-center">
        <!-- Title and UI -->
        <h1 class="text-4xl md:text-5xl text-emerald-700 mb-2 drop-shadow-lg">Safety Simon Says</h1>
        <div class="flex justify-around items-center mb-4 text-xl bg-white/70 backdrop-blur-sm p-3 rounded-full shadow-md">
            <div id="score-display" class="text-blue-700 font-bold">Score: 0</div>
            <div id="lives-display" class="text-red-700 font-bold">Lives: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
        </div>

        <!-- Simon's Command Area -->
        <div class="bg-white rounded-2xl shadow-lg mb-1 p-4">
            <div id="command-area" class="h-28 flex items-center justify-center">
                <p id="command-text" class="text-2xl md:text-3xl text-gray-800"></p>
            </div>
            <!-- Timer Bar -->
            <div class="w-full bg-gray-200 rounded-full h-4">
                <div id="timer-bar" class="bg-yellow-400 h-4 rounded-full" style="width: 100%"></div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div id="action-buttons" class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-6">
            <!-- Buttons will be generated by JS -->
        </div>
    </div>

    <!-- Overlays -->
    <div id="overlay" class="absolute inset-0 flex items-center justify-center bg-black/50">
        <!-- Start Screen -->
        <div id="start-screen" class="text-center text-white p-8 bg-emerald-500/90 backdrop-blur-md rounded-xl shadow-2xl">
            <h2 class="text-3xl md:text-4xl mb-4">Let's Play Safety Simon!</h2>
            <p class="mb-6 md:text-lg">Only click the button if Simon says so!</p>
            <button id="start-button" class="action-button bg-blue-500 text-white text-2xl py-3 px-8 rounded-full">Start Game</button>
        </div>
        <!-- End Screen -->
        <div id="end-screen" class="hidden text-center text-white p-8 bg-purple-500/90 backdrop-blur-md rounded-xl shadow-2xl">
            <h2 class="text-3xl md:text-4xl mb-2">Great Job!</h2>
            <p id="final-score" class="mb-6 md:text-lg text-2xl">Your score: 0</p>
            <button id="restart-button" class="action-button bg-yellow-500 text-white text-2xl py-3 px-8 rounded-full">Play Again</button>
        </div>
    </div>
    
    <!-- Feedback Popup -->
    <div id="feedback-popup" class="hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-8 rounded-2xl text-white text-4xl font-bold drop-shadow-2xl"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <script>
        // --- DOM Elements ---
        const scoreDisplay = document.getElementById('score-display');
        const livesDisplay = document.getElementById('lives-display');
        const commandText = document.getElementById('command-text');
        const actionButtonsContainer = document.getElementById('action-buttons');
        const timerBar = document.getElementById('timer-bar');
        const overlay = document.getElementById('overlay');
        const startScreen = document.getElementById('start-screen');
        const endScreen = document.getElementById('end-screen');
        const finalScoreDisplay = document.getElementById('final-score');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const feedbackPopup = document.getElementById('feedback-popup');

        // --- Game Data ---
        const commands = [
            { id: 'wash', text: 'wash your hands', emoji: 'üßº' },
            { id: 'look', text: 'look both ways', emoji: 'üëÄ' },
            { id: 'helmet', text: 'wear a helmet', emoji: '‚õëÔ∏è' },
            { id: 'veggies', text: 'eat your vegetables', emoji: 'ü•¶' },
            { id: 'cough', text: 'cover your cough', emoji: 'üò∑' },
            { id: 'seatbelt', text: 'buckle your seatbelt', emoji: ' üöó' }
        ];

        // --- Game State ---
        let score = 0;
        let lives = 3;
        let currentCommand = {};
        let simonDidSay = false;
        let roundTimeout, timerInterval;
        const ROUND_TIME = 5000; // 5 seconds

        // --- Sound Synthesis ---
        const synth = new Tone.Synth().toDestination();
        const correctSound = () => synth.triggerAttackRelease("C5", "8n", Tone.now());
        const wrongSound = () => synth.triggerAttackRelease("A3", "8n", Tone.now());
        const waitSound = () => synth.triggerAttackRelease("G4", "8n", Tone.now());

        // --- Functions ---

        function startGame() {
            score = 0;
            lives = 3;
            updateUI();
            overlay.classList.add('hidden');
            generateButtons();
            nextRound();
        }

        function endGame() {
            finalScoreDisplay.textContent = `Your score: ${score}`;
            endScreen.classList.remove('hidden');
            overlay.classList.remove('hidden');
            clearTimers();
        }

        function generateButtons() {
            actionButtonsContainer.innerHTML = '';
            commands.forEach(cmd => {
                const button = document.createElement('button');
                button.className = 'action-button bg-white text-emerald-800 p-4 rounded-2xl text-lg flex flex-col items-center justify-center';
                button.dataset.action = cmd.id;
                button.innerHTML = `<span class="text-5xl">${cmd.emoji}</span><span class="mt-2">${cmd.text}</span>`;
                button.addEventListener('click', handleActionClick);
                actionButtonsContainer.appendChild(button);
            });
        }

        function nextRound() {
            clearTimers();
            currentCommand = commands[Math.floor(Math.random() * commands.length)];
            simonDidSay = Math.random() > 0.3; // 70% chance Simon says

            commandText.textContent = simonDidSay 
                ? `Simon says, ${currentCommand.text}!` 
                : `${currentCommand.text}!`;

            startTimer();
        }

        function handleActionClick(e) {
            if (lives <= 0) return;
            clearTimers();
            const clickedAction = e.currentTarget.dataset.action;

            if (simonDidSay) {
                if (clickedAction === currentCommand.id) {
                    // Correct click
                    score += 10;
                    correctSound();
                    showFeedback(true, "Great!");
                } else {
                    // Wrong button
                    lives--;
                    wrongSound();
                    showFeedback(false, "Oops!");
                }
            } else {
                // Clicked when shouldn't have
                lives--;
                wrongSound();
                showFeedback(false, "Simon didn't say!");
            }
            updateUI();
            setTimeout(checkGameOver, 1000);
        }

        function handleTimeout() {
            if (simonDidSay) {
                // Failed to click
                lives--;
                wrongSound();
                showFeedback(false, "Too slow!");
            } else {
                // Correctly waited
                score += 5;
                waitSound();
                showFeedback(true, "Good job waiting!");
            }
            updateUI();
            setTimeout(checkGameOver, 1000);
        }
        
        function checkGameOver() {
             if (lives <= 0) {
                endGame();
            } else {
                nextRound();
            }
        }

        function startTimer() {
            let timeLeft = ROUND_TIME;
            timerBar.style.width = '100%';
            timerBar.style.transitionDuration = `${ROUND_TIME}ms`;
            timerBar.style.width = '0%';
            
            roundTimeout = setTimeout(handleTimeout, ROUND_TIME);
        }

        function clearTimers() {
            clearTimeout(roundTimeout);
            timerBar.style.transitionDuration = '0s';
        }

        function showFeedback(isCorrect, text) {
            feedbackPopup.textContent = text;
            feedbackPopup.className = `feedback-popup absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-8 rounded-2xl text-white text-4xl font-bold drop-shadow-2xl ${isCorrect ? 'bg-green-500' : 'bg-red-500'}`;
            
            setTimeout(() => {
                feedbackPopup.className += ' hidden';
            }, 800);
        }
        
        function updateUI() {
            scoreDisplay.textContent = `Score: ${score}`;
            livesDisplay.innerHTML = `Lives: ${'‚ù§Ô∏è'.repeat(lives)}${'ü§ç'.repeat(3 - lives)}`;
        }

        // --- Event Listeners ---
        startButton.addEventListener('click', () => {
            Tone.start();
            startScreen.classList.add('hidden');
            startGame();
        });

        restartButton.addEventListener('click', () => {
            endScreen.classList.add('hidden');
            startGame();
        });
    </script>
</body>
</html>

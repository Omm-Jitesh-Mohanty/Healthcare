<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brush the Germs Away!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fredoka One', cursive;
            background-color: #FBCFE8; /* A friendly pink */
            touch-action: none;
            overflow: hidden;
        }
        canvas {
            background-color: #F472B6; /* A darker pink for the mouth background */
            border-radius: 2rem;
            cursor: none; /* Hide the cursor, we'll draw a toothbrush */
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
        }
        .game-button {
            transition: all 0.2s ease-in-out;
        }
        .game-button:hover {
            transform: translateY(-2px) scale(1.05);
        }
         /* Sparkle animation for clean teeth */
        @keyframes sparkle {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
        }
        .sparkle {
            position: absolute;
            font-size: 1.5rem;
            animation: sparkle 0.5s ease-out;
            pointer-events: none; /* Make sure they don't interfere with mouse events */
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <div id="game-container" class="relative w-full max-w-2xl mx-auto text-center">
        <h1 class="text-4xl md:text-5xl text-pink-700 mb-2 drop-shadow-lg">Brush the Germs Away!</h1>
        
        <!-- Game UI: Score and Timer -->
        <div class="flex justify-around items-center mb-4 text-xl bg-white/70 backdrop-blur-sm p-3 rounded-full shadow-md">
            <div id="score-display" class="text-green-700 font-bold">Score: 0</div>
            <div id="timer-display" class="text-red-700 font-bold">Time: 30</div>
        </div>
        
        <canvas id="gameCanvas"></canvas>
    </div>

    <!-- Overlays -->
    <div id="overlay" class="absolute inset-0 flex items-center justify-center bg-black/50">
        <!-- Start Screen -->
        <div id="start-screen" class="text-center text-white p-8 bg-pink-500/90 backdrop-blur-md rounded-xl shadow-2xl">
            <h2 class="text-3xl md:text-4xl mb-4">Ready to Brush?</h2>
            <p class="mb-6 md:text-lg">Clean all the germs off the teeth before time runs out!</p>
            <button id="start-button" class="game-button bg-blue-500 text-white text-2xl py-3 px-8 rounded-full">Start Brushing</button>
        </div>
        <!-- End Screen -->
        <div id="end-screen" class="hidden text-center text-white p-8 bg-green-500/90 backdrop-blur-md rounded-xl shadow-2xl">
            <h2 class="text-3xl md:text-4xl mb-2">Sparkly Clean!</h2>
            <p id="final-score" class="mb-6 md:text-lg text-2xl">Your score: 0</p>
            <button id="restart-button" class="game-button bg-yellow-500 text-white text-2xl py-3 px-8 rounded-full">Play Again</button>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <script>
        // --- DOM Elements ---
        const gameContainer = document.getElementById('game-container');
        const scoreDisplay = document.getElementById('score-display');
        const timerDisplay = document.getElementById('timer-display');
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const overlay = document.getElementById('overlay');
        const startScreen = document.getElementById('start-screen');
        const endScreen = document.getElementById('end-screen');
        const finalScoreDisplay = document.getElementById('final-score');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        
        // --- Game State & Settings ---
        let score = 0;
        let timeLeft = 30;
        let isGameOver = true;
        let timerInterval;
        let gameLoopId;
        const germs = [];
        const toothLocations = [];
        const toothbrush = { x: -100, y: -100, size: 80, emoji: 'ðŸª¥', isBrushing: false };

        // --- Sound Synthesis ---
        const synth = new Tone.PolySynth(Tone.Synth).toDestination();
        const cleanSound = () => synth.triggerAttackRelease("C5", "16n");
        const spawnSound = () => synth.triggerAttackRelease("G3", "16n");

        // --- Functions ---

        function resizeCanvas() {
            const container = document.getElementById('game-container');
            canvas.width = container.clientWidth;
            canvas.height = window.innerHeight * 0.5; // Make it wider than tall
            drawMouth(); // Redraw static elements on resize
        }
        
        function drawMouth() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            toothLocations.length = 0; // Clear previous locations
            
            const numTeethTop = 8;
            const numTeethBottom = 8;
            const toothWidth = canvas.width / (numTeethTop + 1);
            const toothHeight = toothWidth * 0.8;
            
            ctx.fillStyle = '#FFD1DC'; // Gums color

            // Gums
            ctx.beginPath();
            ctx.moveTo(0, toothHeight * 0.8);
            ctx.bezierCurveTo(canvas.width / 2, -toothHeight * 0.5, canvas.width / 2, -toothHeight * 0.5, canvas.width, toothHeight * 0.8);
            ctx.lineTo(canvas.width, 0);
            ctx.lineTo(0, 0);
            ctx.fill();

            ctx.beginPath();
            ctx.moveTo(0, canvas.height - toothHeight * 0.8);
            ctx.bezierCurveTo(canvas.width / 2, canvas.height + toothHeight * 0.5, canvas.width / 2, canvas.height + toothHeight * 0.5, canvas.width, canvas.height - toothHeight * 0.8);
            ctx.lineTo(canvas.width, canvas.height);
            ctx.lineTo(0, canvas.height);
            ctx.fill();

            // Teeth
            ctx.fillStyle = 'white';
            ctx.strokeStyle = '#E5E7EB';
            ctx.lineWidth = 2;
            for (let i = 0; i < numTeethTop; i++) {
                const x = toothWidth * (i + 0.5);
                const y = 0;
                ctx.fillRect(x, y, toothWidth * 0.8, toothHeight);
                ctx.strokeRect(x, y, toothWidth * 0.8, toothHeight);
                toothLocations.push({ x: x + toothWidth * 0.4, y: toothHeight * 0.5 });
            }
            for (let i = 0; i < numTeethBottom; i++) {
                const x = toothWidth * (i + 0.5);
                const y = canvas.height - toothHeight;
                ctx.fillRect(x, y, toothWidth * 0.8, toothHeight);
                ctx.strokeRect(x, y, toothWidth * 0.8, toothHeight);
                toothLocations.push({ x: x + toothWidth * 0.4, y: y + toothHeight * 0.5 });
            }
        }

        function spawnGerm() {
            if (isGameOver || toothLocations.length === 0) return;
            
            const location = toothLocations[Math.floor(Math.random() * toothLocations.length)];
            const size = 30 + Math.random() * 15;
            const offsetX = (Math.random() - 0.5) * 20;
            const offsetY = (Math.random() - 0.5) * 20;

            germs.push({
                x: location.x + offsetX,
                y: location.y + offsetY,
                size: size,
                emoji: 'ðŸ¦ '
            });
            spawnSound();
        }

        function drawGerms() {
            ctx.font = '30px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            germs.forEach(germ => {
                ctx.save();
                ctx.font = `${germ.size}px sans-serif`;
                ctx.fillText(germ.emoji, germ.x, germ.y);
                ctx.restore();
            });
        }
        
        function drawToothbrush() {
            ctx.save();
            ctx.font = `${toothbrush.size}px sans-serif`;
            ctx.translate(toothbrush.x, toothbrush.y);
            ctx.rotate(-Math.PI / 4); // Angle the toothbrush
            ctx.fillText(toothbrush.emoji, 0, 0);
            ctx.restore();
        }

        function updateGame() {
            if (isGameOver) return;
            
            drawMouth();
            drawGerms();
            drawToothbrush();

            if (toothbrush.isBrushing) {
                checkCollisions();
            }

            gameLoopId = requestAnimationFrame(updateGame);
        }
        
        function checkCollisions() {
            for (let i = germs.length - 1; i >= 0; i--) {
                const germ = germs[i];
                const dist = Math.hypot(toothbrush.x - germ.x, toothbrush.y - germ.y);
                if (dist < toothbrush.size / 2 + germ.size / 2) {
                    createSparkle(germ.x, germ.y);
                    germs.splice(i, 1);
                    score += 10;
                    cleanSound();
                    updateUI();
                }
            }
        }

        function createSparkle(x, y) {
            const sparkle = document.createElement('div');
            sparkle.textContent = 'âœ¨';
            sparkle.className = 'sparkle';
            // Adjust position relative to the canvas
            const canvasRect = canvas.getBoundingClientRect();
            sparkle.style.left = `${canvasRect.left + x}px`;
            sparkle.style.top = `${canvasRect.top + y}px`;
            
            document.body.appendChild(sparkle);
            setTimeout(() => {
                sparkle.remove();
            }, 500);
        }

        function updateUI() {
            scoreDisplay.textContent = `Score: ${score}`;
            timerDisplay.textContent = `Time: ${timeLeft}`;
        }
        
        function startGame() {
            isGameOver = false;
            score = 0;
            timeLeft = 30;
            germs.length = 0;
            
            updateUI();
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateUI();
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);

            // Spawn germs periodically
            spawnGerm();
            setInterval(spawnGerm, 1000);

            overlay.classList.add('hidden');
            updateGame();
        }
        
        function endGame() {
            isGameOver = true;
            clearInterval(timerInterval);
            cancelAnimationFrame(gameLoopId);
            
            finalScoreDisplay.textContent = `Your score: ${score}`;
            endScreen.classList.remove('hidden');
            overlay.classList.remove('hidden');
        }

        function moveHandler(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            toothbrush.x = clientX - rect.left;
            toothbrush.y = clientY - rect.top;
        }

        // --- Event Listeners ---
        window.addEventListener('resize', resizeCanvas);
        
        startButton.addEventListener('click', () => {
            Tone.start();
            startScreen.classList.add('hidden');
            startGame();
        });

        restartButton.addEventListener('click', () => {
            endScreen.classList.add('hidden');
            startGame();
        });

        canvas.addEventListener('mousedown', (e) => { toothbrush.isBrushing = true; moveHandler(e); });
        canvas.addEventListener('mouseup', () => { toothbrush.isBrushing = false; });
        canvas.addEventListener('mouseleave', () => { toothbrush.isBrushing = false; });
        canvas.addEventListener('mousemove', moveHandler);

        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); toothbrush.isBrushing = true; moveHandler(e); });
        canvas.addEventListener('touchend', (e) => { e.preventDefault(); toothbrush.isBrushing = false; });
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); moveHandler(e); });


        // --- Initial Setup ---
        resizeCanvas();

    </script>
</body>
</html>

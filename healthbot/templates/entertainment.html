{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Comics ‚Äî Entertainment</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <link rel="stylesheet" href="{% static 'css/style.css' %}">

  <style>
    /* Local gallery styles (you can copy to your main CSS) */
    .page-container { max-width: 1100px; margin: 24px auto; padding: 16px; font-family: sans-serif; }
    h1 { margin-bottom: 10px; }
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
    }
    .comic-card {
      background: #fff;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
      text-align: center;
      cursor: pointer;
    }
    .comic-card img {
      width: 100%;
      height: 260px;
      object-fit: contain;
      border-radius: 6px;
      display:block;
      margin: 0 auto;
    }
    .placeholder {
      text-align:center;
      padding: 40px;
      color:#666;
    }

    /* Modal / Lightbox */
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0; top: 0; right:0; bottom:0;
      background: rgba(0,0,0,0.8);
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    .modal.open { display: flex; }
    .modal-content {
      max-width: 95%;
      max-height: 95%;
      position: relative;
    }
    .modal-content img {
      width: auto;
      max-width: 100%;
      max-height: 85vh;
      display:block;
      margin: 0 auto;
    }
    .modal-close, .modal-prev, .modal-next {
      position: absolute;
      top: 8px;
      background: rgba(255,255,255,0.9);
      border: none;
      padding: 8px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .modal-close { right: 8px; }
    .modal-prev { left: 8px; top: 50%; transform: translateY(-50%); }
    .modal-next { right: 8px; top: 50%; transform: translateY(-50%); }

    @media (max-width: 480px){
      .comic-card img { height: 160px; }
    }
  </style>
</head>
<body>
  <main class="page-container" role="main">
    <header>
      <h1>üé® Entertainment ‚Äî Comics</h1>
      <p>Click any comic to enlarge. Use arrows or ‚Üê ‚Üí keys to navigate.</p>
    </header>

    {% if images %}
      <section class="gallery-grid" id="gallery">
        {% for img in images %}
          <div class="comic-card" data-index="{{ forloop.counter0 }}">
            <img src="{% static img %}" alt="Comic {{ forloop.counter }}">
          </div>
        {% endfor %}
      </section>
    {% else %}
      <div class="placeholder">
        <p>No comics were found. Please upload images to <code>static/comics/</code>.</p>
      </div>
    {% endif %}

    <!-- Modal -->
    <div id="modal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
      <div class="modal-content">
        <button class="modal-close" id="modalClose" title="Close">‚úï</button>
        <button class="modal-prev" id="modalPrev" title="Previous">‚óÄ</button>
        <img id="modalImg" src="" alt="Comic enlarged">
        <button class="modal-next" id="modalNext" title="Next">‚ñ∂</button>
      </div>
    </div>
  </main>

  <script>
    (function(){
      const images = Array.from(document.querySelectorAll('.comic-card img')).map(img=>img.src);
      const cards = document.querySelectorAll('.comic-card');
      const modal = document.getElementById('modal');
      const modalImg = document.getElementById('modalImg');
      const closeBtn = document.getElementById('modalClose');
      const prevBtn = document.getElementById('modalPrev');
      const nextBtn = document.getElementById('modalNext');
      let currentIndex = 0;

      function openModal(index){
        if (index < 0 || index >= images.length) return;
        currentIndex = index;
        modalImg.src = images[currentIndex];
        modal.classList.add('open');
        modal.setAttribute('aria-hidden','false');
        document.body.style.overflow = 'hidden';
      }
      function closeModal(){
        modal.classList.remove('open');
        modal.setAttribute('aria-hidden','true');
        document.body.style.overflow = '';
      }
      function prev(){
        openModal((currentIndex - 1 + images.length) % images.length);
      }
      function next(){
        openModal((currentIndex + 1) % images.length);
      }

      cards.forEach(card=>{
        card.addEventListener('click', ()=> {
          const idx = parseInt(card.dataset.index, 10);
          openModal(idx);
        });
      });

      closeBtn.addEventListener('click', closeModal);
      prevBtn.addEventListener('click', prev);
      nextBtn.addEventListener('click', next);

      // Close modal on overlay click (not on image)
      modal.addEventListener('click', (e)=>{
        if (e.target === modal) closeModal();
      });

      // Keyboard navigation
      window.addEventListener('keydown', (e)=>{
        if (!modal.classList.contains('open')) return;
        if (e.key === 'Escape') closeModal();
        if (e.key === 'ArrowLeft') prev();
        if (e.key === 'ArrowRight') next();
      });
    })();
  </script>
</body>
</html>
